<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üíò Queres ser a minha Valentine?</title>
  <meta name="theme-color" content="#ff4d7d" />
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#1a0f1f;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --text:#fff;
      --muted: rgba(255,255,255,.78);
      --accent:#ff4d7d;
      --accent2:#ffb3c7;
      --good:#34d399;
      --shadow: 0 24px 60px rgba(0,0,0,.45);
      --radius: 24px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% 20%, rgba(255,77,125,.20), transparent 55%),
        radial-gradient(900px 700px at 85% 10%, rgba(255,179,199,.16), transparent 60%),
        radial-gradient(900px 700px at 70% 90%, rgba(52,211,153,.12), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    /* floating hearts background */
    .hearts{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.9;
      filter: drop-shadow(0 8px 14px rgba(0,0,0,.35));
      z-index: 1;
    }
    .heart{
      position:absolute;
      width:14px; height:14px;
      transform: rotate(45deg);
      background: rgba(255,77,125,.35);
      border-radius: 3px;
      animation: floatUp linear infinite;
      will-change: transform, opacity;
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width:14px;height:14px;
      background: inherit;
      border-radius:50%;
    }
    .heart:before{ left:-7px; top:0;}
    .heart:after{ left:0; top:-7px;}
    @keyframes floatUp{
      0%{ transform: translateY(110vh) rotate(45deg) scale(1); opacity:0}
      10%{opacity:1}
      100%{ transform: translateY(-20vh) rotate(45deg) scale(1.2); opacity:0}
    }

    /* subtle star dust */
    .dust{
      position:fixed; inset:0;
      pointer-events:none;
      z-index: 1;
      opacity: .65;
    }
    .dustDot{
      position:absolute;
      width:2px; height:2px;
      border-radius:999px;
      background: rgba(255,255,255,.88);
      box-shadow: 0 0 12px rgba(255,255,255,.45);
      animation: dustTwinkle 2.6s ease-in-out infinite;
    }
    @keyframes dustTwinkle{
      0%,100%{ transform: scale(.8); opacity:.22 }
      50%{ transform: scale(1.9); opacity:1 }
    }

    .wrap{
      position:relative;
      height:100%;
      display:grid;
      place-items:center;
      padding: 22px;
      z-index: 2;
    }

    .card{
      width:min(720px, 100%);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(14px);
      transform-style: preserve-3d;
      will-change: transform;
    }

    .topGlow{
      position:absolute; inset:-2px;
      background: radial-gradient(700px 260px at 30% 0%, rgba(255,77,125,.35), transparent 60%),
                  radial-gradient(600px 260px at 80% 0%, rgba(52,211,153,.18), transparent 60%);
      pointer-events:none;
      opacity:.9;
    }

    .content{
      position:relative;
      padding: 28px 22px 22px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 18px;
      align-items:center;
    }

    @media (max-width: 760px){
      .content{ grid-template-columns: 1fr; text-align:center; padding: 22px 18px 18px; }
      .actions{ justify-content:center; }
      .badgeRow{ justify-content:center; }
    }

    h1{
      font-size: clamp(28px, 3.6vw, 44px);
      line-height:1.05;
      margin: 0 0 10px 0;
      letter-spacing:-.02em;
    }
    .sub{
      margin:0 0 14px 0;
      color: var(--muted);
      font-size: clamp(14px, 1.6vw, 16px);
    }

    .badgeRow{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-top: 10px;
    }
    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 10px 12px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      font-size: 13px;
      color: rgba(255,255,255,.88);
    }
    .dot{
      width:10px; height:10px;
      border-radius:999px;
      background: rgba(255,77,125,.9);
      box-shadow: 0 0 18px rgba(255,77,125,.55);
    }

    .bearArea{
      display:grid;
      place-items:center;
      padding: 8px 8px 16px;
    }

    /* Cute bear (pure CSS) */
    .bear{
      width: min(260px, 74vw);
      aspect-ratio: 1 / 1;
      position:relative;
      transform: translateY(6px);
      animation: bob 2.8s ease-in-out infinite;
      filter: drop-shadow(0 18px 30px rgba(0,0,0,.35));
      will-change: transform;
    }
    @keyframes bob{
      0%,100%{ transform: translateY(8px) }
      50%{ transform: translateY(0px) }
    }
    .bear .head{
      position:absolute;
      inset: 10% 10% 20% 10%;
      background: linear-gradient(180deg, #c8905e, #b87944);
      border-radius: 46% 46% 40% 40%;
      border: 2px solid rgba(255,255,255,.12);
    }
    .bear .ear{
      position:absolute;
      width: 28%;
      height: 28%;
      background: linear-gradient(180deg, #c8905e, #b87944);
      border-radius: 50%;
      top: 2%;
      border: 2px solid rgba(255,255,255,.12);
    }
    .bear .ear.left{ left: 4%; transform: rotate(-10deg); }
    .bear .ear.right{ right: 4%; transform: rotate(10deg); }
    .bear .ear:after{
      content:"";
      position:absolute;
      inset: 22%;
      background: rgba(255,214,176,.75);
      border-radius: 50%;
    }

    .bear .face{
      position:absolute;
      inset: 18% 14% 24% 14%;
    }
    .bear .eye{
      position:absolute;
      width: 10%;
      height: 10%;
      background: #1b1b1b;
      border-radius: 50%;
      top: 28%;
      transform-origin:center;
    }
    .bear .eye.left{ left: 24%; }
    .bear .eye.right{ right: 24%; }
    .bear .eye:after{
      content:"";
      position:absolute;
      width: 38%;
      height: 38%;
      background: rgba(255,255,255,.92);
      border-radius: 50%;
      top: 18%; left: 18%;
    }
    .bear.wink .eye.right{
      transform: scaleY(.15);
      border-radius: 10px;
      background: rgba(0,0,0,.75);
    }

    .bear .blush{
      position:absolute;
      width: 14%;
      height: 10%;
      background: rgba(255,77,125,.26);
      border-radius: 999px;
      top: 45%;
      filter: blur(.2px);
    }
    .bear .blush.left{ left: 10%;}
    .bear .blush.right{ right: 10%;}

    .bear .snout{
      position:absolute;
      left: 50%;
      top: 48%;
      transform: translateX(-50%);
      width: 42%;
      height: 34%;
      background: linear-gradient(180deg, rgba(255,214,176,.95), rgba(255,214,176,.78));
      border-radius: 40% 40% 55% 55%;
      border: 2px solid rgba(0,0,0,.06);
    }
    .bear .nose{
      position:absolute;
      left: 50%;
      top: 18%;
      transform: translateX(-50%);
      width: 26%;
      height: 20%;
      background:#1b1b1b;
      border-radius: 40% 40% 55% 55%;
    }
    .bear .mouth{
      position:absolute;
      left: 50%;
      top: 42%;
      transform: translateX(-50%);
      width: 40%;
      height: 28%;
    }
    .bear .mouth:before,
    .bear .mouth:after{
      content:"";
      position:absolute;
      width: 52%;
      height: 70%;
      border: 3px solid rgba(27,27,27,.85);
      border-top:0;
      border-left:0;
      border-radius: 0 0 18px 0;
      top: 10%;
    }
    .bear .mouth:before{ left: 0; transform: scaleX(-1); }
    .bear .mouth:after{ right: 0; }

    .bear .paw{
      position:absolute;
      width: 34%;
      height: 24%;
      background: linear-gradient(180deg, #c8905e, #b87944);
      border-radius: 999px;
      bottom: 6%;
      border: 2px solid rgba(255,255,255,.12);
    }
    .bear .paw.left{ left: 8%; transform: rotate(10deg); }
    .bear .paw.right{ right: 8%; transform: rotate(-10deg); }
    .bear .paw:after{
      content:"";
      position:absolute;
      inset: 26%;
      background: rgba(255,214,176,.75);
      border-radius: 999px;
    }

    .tinyHeart{
      position:absolute;
      width: 18%;
      height: 18%;
      left: 50%;
      top: -2%;
      transform: translateX(-50%) rotate(45deg);
      background: rgba(255,77,125,.85);
      border-radius: 6px;
      box-shadow: 0 12px 26px rgba(255,77,125,.35);
      animation: pop 1.8s ease-in-out infinite;
    }
    .tinyHeart:before,.tinyHeart:after{
      content:"";
      position:absolute;
      width:100%; height:100%;
      background: inherit;
      border-radius: 50%;
    }
    .tinyHeart:before{ left:-50%; top:0;}
    .tinyHeart:after{ left:0; top:-50%;}
    @keyframes pop{
      0%,100%{ transform: translateX(-50%) rotate(45deg) scale(1) }
      50%{ transform: translateX(-50%) rotate(45deg) scale(1.08) }
    }

    .actions{
      display:flex;
      gap: 12px;
      align-items:center;
      flex-wrap:wrap;
      margin-top: 16px;
      position: relative;
      z-index: 3;
    }

    button{
      appearance:none;
      border:0;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.01em;
      border-radius: 999px;
      padding: 14px 18px;
      font-size: 16px;
      transition: transform .12s ease, box-shadow .18s ease, filter .18s ease, opacity .18s ease;
      user-select:none;
      touch-action: manipulation;
      will-change: transform;
    }

    .btnYes{
      background: linear-gradient(180deg, rgba(255,77,125,1), rgba(255,77,125,.86));
      color: white;
      box-shadow: 0 14px 30px rgba(255,77,125,.28);
      position: relative;
      z-index: 3;
    }
    .btnYes:hover{ transform: translateY(-1px) scale(1.01); filter: brightness(1.03); }
    .btnYes:active{ transform: translateY(0px) scale(.99); }

    .btnNo{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      color: rgba(255,255,255,.92);
      box-shadow: 0 14px 30px rgba(0,0,0,.25);
      position: relative;
      z-index: 3;
    }
    .btnNo:hover{ transform: translateY(-1px); }
    .btnNo:active{ transform: translateY(0px) scale(.99); }

    .note{
      margin-top: 10px;
      font-size: 13px;
      color: rgba(255,255,255,.72);
      min-height: 18px;
    }

    .footer{
      border-top: 1px solid rgba(255,255,255,.10);
      padding: 14px 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      color: rgba(255,255,255,.70);
      font-size: 12px;
    }
    .mini{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .pill{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
    }

    /* Confetti canvas */
    canvas#confetti{
      position:fixed; inset:0;
      pointer-events:none;
      z-index: 40;
    }

    /* YES button "portal" takeover */
    .yesFloating{
      position: fixed !important;
      z-index: 9999 !important;
      margin: 0 !important;
      transform-origin: center center;
      transition: none !important; /* animated via WAAPI */
      will-change: left, top, width, height, transform, filter;
    }
    .yesAura{
      box-shadow:
        0 20px 40px rgba(255,77,125,.28),
        0 0 0 14px rgba(255,77,125,.10),
        0 0 0 34px rgba(255,77,125,.06),
        0 0 140px rgba(255,77,125,.22);
    }

    /* sparkles overlay */
    .sparkles{
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 24;
      opacity: 0;
      transition: opacity .35s ease;
    }
    .sparkles.on{ opacity: 1; }
    .sparkle{
      position:absolute;
      width: 2px;
      height: 2px;
      border-radius: 999px;
      background: rgba(255,255,255,.85);
      box-shadow: 0 0 14px rgba(255,255,255,.55);
      animation: twinkle 1.6s ease-in-out infinite;
    }
    @keyframes twinkle{
      0%,100%{ transform: scale(.8); opacity:.35 }
      50%{ transform: scale(1.8); opacity:1 }
    }

    /* HUD controls */
    .hud{
      position: fixed;
      right: 14px;
      top: 14px;
      z-index: 80;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .hud button{
      padding: 10px 12px;
      font-size: 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      color: rgba(255,255,255,.92);
      box-shadow: 0 14px 30px rgba(0,0,0,.20);
    }

    /* Letter modal */
    .modal{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      padding: 18px;
      z-index: 60;
    }
    .modal.open{ display:grid; }

    .letterWrap{
      width:min(680px, 100%);
      position:relative;
      filter: drop-shadow(0 26px 58px rgba(0,0,0,.55));
      transform: translateY(8px);
      animation: letterIn .45s ease-out forwards;
    }
    @keyframes letterIn{
      from{ opacity:0; transform: translateY(18px) scale(.98); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .envelope{
      position:absolute;
      inset: 0;
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.16);
      overflow:hidden;
    }
    .envelope:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(520px 220px at 30% 0%, rgba(255,77,125,.28), transparent 60%),
        radial-gradient(520px 240px at 80% 0%, rgba(52,211,153,.16), transparent 60%);
      opacity:.9;
      pointer-events:none;
    }
    .seal{
      position:absolute;
      top: 18px;
      right: 18px;
      width: 54px;
      height: 54px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), rgba(255,255,255,.05)),
                  linear-gradient(180deg, rgba(255,77,125,1), rgba(255,77,125,.82));
      box-shadow: 0 16px 36px rgba(255,77,125,.25);
      display:grid;
      place-items:center;
      transform: rotate(8deg);
      border: 1px solid rgba(255,255,255,.14);
      user-select:none;
    }
    .seal span{
      font-size: 18px;
      transform: rotate(-8deg);
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.25));
    }

    .paper{
      position:relative;
      margin: 20px;
      padding: 18px 18px 16px;
      border-radius: 20px;
      background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.86));
      color: rgba(20,20,20,.92);
      border: 1px solid rgba(0,0,0,.06);
      overflow:hidden;
    }
    .paper:before{
      content:"";
      position:absolute;
      inset: 0;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(0,0,0,.035) 0px,
          rgba(0,0,0,.035) 1px,
          transparent 1px,
          transparent 28px
        );
      opacity:.45;
      pointer-events:none;
    }

    .paperHeader{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      position:relative;
    }
    .paperHeader h2{
      margin: 0;
      font-size: clamp(20px, 3vw, 30px);
      letter-spacing:-.02em;
    }
    .stamp{
      font-size: 12px;
      background: rgba(255,77,125,.14);
      border: 1px dashed rgba(255,77,125,.45);
      padding: 8px 10px;
      border-radius: 12px;
      color: rgba(120,20,55,.92);
      font-weight: 900;
    }

    .letterText{
      margin-top: 12px;
      line-height: 1.55;
      font-size: 16px;
      position:relative;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
    }
    .typeLine{
      white-space: pre-wrap;
      margin: 0 0 10px 0;
    }

    .signature{
      margin-top: 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      position:relative;
    }
    .signName{
      font-family: "Brush Script MT", "Segoe Script", "Snell Roundhand", cursive;
      font-size: 26px;
      color: rgba(20,20,20,.88);
      transform: rotate(-1.5deg);
    }
    .btnRow{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    .btnGhost{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      color: rgba(255,255,255,.92);
      font-weight: 900;
    }
    .btnSmall{
      padding: 12px 16px;
      font-size: 15px;
    }

    /* mini toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%) translateY(12px);
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 999px;
      padding: 10px 14px;
      color: rgba(255,255,255,.88);
      backdrop-filter: blur(12px);
      box-shadow: 0 18px 48px rgba(0,0,0,.35);
      opacity: 0;
      z-index: 90;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
    }
    .toast.on{
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* reduced motion support */
    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition: none !important; }
    }
  </style>
</head>

<body>
  <canvas id="confetti"></canvas>

  <div class="hearts" aria-hidden="true" id="hearts"></div>
  <div class="dust" aria-hidden="true" id="dust"></div>
  <div class="sparkles" aria-hidden="true" id="sparkles"></div>

  <div class="hud">
    <button id="muteBtn" type="button" aria-label="Som">üîä Som</button>
    <button id="resetBtn" type="button" aria-label="Reiniciar">‚Ü∫ Reset</button>
  </div>

  <div class="toast" id="toast">üíò</div>

  <main class="wrap">
    <section class="card" id="card" role="article" aria-label="Convite de Valentine">
      <div class="topGlow"></div>

      <div class="content">
        <div>
          <h1 id="title">Queres ser a minha <span style="color:var(--accent)">Valentine</span>? üíò</h1>
          <p class="sub" id="subtitle">
            Prometo: filmes bons, comida favorita, e eu a tratar-te como a pessoa mais especial do mundo.
          </p>

          <div class="badgeRow">
            <span class="badge"><span class="dot"></span> 14 de Fevereiro</span>
            <span class="badge">üêª Ursinho de aprova√ß√£o</span>
            <span class="badge">üíå Responde com o cora√ß√£o</span>
          </div>

          <div class="actions" id="actions">
            <button id="yesBtn" class="btnYes" type="button">SIM üòç</button>
            <button id="noBtn" class="btnNo" type="button">N√ÉO üôÉ</button>
          </div>

          <div class="note" id="note">
            (Dica: o ‚ÄúN√£o‚Äù parece que est√° um bocado t√≠mido hoje.)
          </div>
        </div>

        <div class="bearArea">
          <div class="bear" id="bear" aria-hidden="true">
            <div class="tinyHeart"></div>
            <div class="ear left"></div>
            <div class="ear right"></div>
            <div class="head">
              <div class="face">
                <div class="eye left"></div>
                <div class="eye right"></div>
                <div class="blush left"></div>
                <div class="blush right"></div>
                <div class="snout">
                  <div class="nose"></div>
                  <div class="mouth"></div>
                </div>
              </div>
            </div>
            <div class="paw left"></div>
            <div class="paw right"></div>
          </div>
        </div>
      </div>

      <div class="footer">
        <div class="mini">
          <span class="pill">feito com ‚ù§Ô∏è</span>
          <span class="pill" id="triesPill">tentativas do ‚ÄúN√£o‚Äù: 0</span>
        </div>
        <div class="mini">
          <span class="pill" id="timePill">agora: --:--</span>
        </div>
      </div>
    </section>
  </main>

  <!-- Letter modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="Carta de Valentine">
    <div class="letterWrap" role="document" id="letterWrap">
      <div class="envelope">
        <div class="seal"><span>üíå</span></div>
      </div>

      <div class="paper" aria-label="Carta" id="paper">
        <div class="paperHeader">
          <h2 id="letterTitle">Carta para ti üíñ</h2>
          <div class="stamp" id="letterStamp">OFICIAL</div>
        </div>

        <div class="letterText" id="letterText"></div>

        <div class="signature">
          <div class="signName" id="signName">‚Äî Eu</div>
          <div class="btnRow">
            <button class="btnYes btnSmall" id="copyBtn" type="button">Copiar üíå</button>
            <button class="btnGhost btnSmall" id="saveBtn" type="button">Guardar PNG üñºÔ∏è</button>
            <button class="btnGhost btnSmall" id="closeBtn" type="button">Fechar</button>
          </div>
        </div>

        <div class="note" id="copyNote" style="margin-top:10px; color: rgba(0,0,0,.62);"></div>
      </div>
    </div>
  </div>

  <script>
    // ==========================
    // PERSONALIZA (opcional)
    // ==========================
    const NAME = "";   // ex: "In√™s"
    const FROM = "";   // ex: "H√©lder"
    // ==========================

    // Elements
    const yesBtn = document.getElementById("yesBtn");
    const noBtn  = document.getElementById("noBtn");
    const title  = document.getElementById("title");
    const subtitle = document.getElementById("subtitle");
    const note = document.getElementById("note");
    const triesPill = document.getElementById("triesPill");
    const timePill = document.getElementById("timePill");
    const actions = document.getElementById("actions");
    const card = document.getElementById("card");
    const bear = document.getElementById("bear");

    const modal = document.getElementById("modal");
    const closeBtn = document.getElementById("closeBtn");
    const copyBtn = document.getElementById("copyBtn");
    const saveBtn = document.getElementById("saveBtn");
    const copyNote = document.getElementById("copyNote");
    const letterTitle = document.getElementById("letterTitle");
    const letterStamp = document.getElementById("letterStamp");
    const letterText = document.getElementById("letterText");
    const signName = document.getElementById("signName");
    const letterWrap = document.getElementById("letterWrap");
    const paper = document.getElementById("paper");

    const sparkles = document.getElementById("sparkles");
    const dust = document.getElementById("dust");
    const muteBtn = document.getElementById("muteBtn");
    const resetBtn = document.getElementById("resetBtn");
    const toast = document.getElementById("toast");

    // Dynamic greeting
    if (NAME) title.innerHTML = `Queres ser a minha <span style="color:var(--accent)">Valentine</span>, ${NAME}? üíò`;
    if (FROM) subtitle.textContent = `Prometo: filmes bons, comida favorita, e eu (${FROM}) a tratar-te como a pessoa mais especial do mundo.`;
    if (FROM) signName.textContent = `‚Äî ${FROM}`;
    if (NAME) letterTitle.textContent = `Carta para ti, ${NAME} üíñ`;

    // time
    function tickTime(){
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      timePill.textContent = `agora: ${hh}:${mm}`;
    }
    tickTime();
    setInterval(tickTime, 1000);

    // Background hearts
    const heartsWrap = document.getElementById("hearts");
    const HEARTS = 26;
    for(let i=0;i<HEARTS;i++){
      const h = document.createElement("div");
      h.className = "heart";
      const left = Math.random()*100;
      const dur = 6 + Math.random()*8;
      const delay = -Math.random()*dur;
      const size = 10 + Math.random()*14;
      h.style.left = left + "vw";
      h.style.animationDuration = dur + "s";
      h.style.animationDelay = delay + "s";
      h.style.width = size + "px";
      h.style.height = size + "px";
      h.style.opacity = (0.35 + Math.random()*0.45).toFixed(2);
      heartsWrap.appendChild(h);
    }

    // Star dust
    const DUST = 70;
    for(let i=0;i<DUST;i++){
      const d = document.createElement("div");
      d.className = "dustDot";
      d.style.left = (Math.random()*100) + "vw";
      d.style.top  = (Math.random()*100) + "vh";
      d.style.animationDelay = (Math.random()*2.6) + "s";
      d.style.opacity = (0.18 + Math.random()*0.65).toFixed(2);
      dust.appendChild(d);
    }

    // Sparkles overlay
    const SP = 80;
    for(let i=0;i<SP;i++){
      const s = document.createElement("div");
      s.className = "sparkle";
      s.style.left = (Math.random()*100) + "vw";
      s.style.top  = (Math.random()*100) + "vh";
      s.style.animationDelay = (Math.random()*1.6) + "s";
      s.style.opacity = (0.25 + Math.random()*0.6).toFixed(2);
      sparkles.appendChild(s);
    }

    // Tiny toast helper
    let toastTimer = null;
    function showToast(text){
      toast.textContent = text;
      toast.classList.add("on");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.classList.remove("on"), 1200);
    }

    // ==========================
    // AUDIO (WebAudio, sem ficheiros)
    // ==========================
    let audioOn = true;
    let actx = null;

    function ensureAudio(){
      if(!actx){
        actx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if(actx.state === "suspended") actx.resume();
    }

    function beep(type="pop"){
      if(!audioOn) return;
      ensureAudio();
      const t0 = actx.currentTime;

      const o = actx.createOscillator();
      const g = actx.createGain();
      o.connect(g); g.connect(actx.destination);

      if(type==="pop"){
        o.type = "triangle";
        o.frequency.setValueAtTime(420, t0);
        o.frequency.exponentialRampToValueAtTime(180, t0 + 0.08);
        g.gain.setValueAtTime(0.0001, t0);
        g.gain.exponentialRampToValueAtTime(0.12, t0 + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.10);
        o.start(t0); o.stop(t0 + 0.12);
      }else if(type==="yes"){
        o.type = "sine";
        o.frequency.setValueAtTime(440, t0);
        o.frequency.setValueAtTime(554, t0+0.05);
        o.frequency.setValueAtTime(659, t0+0.10);
        g.gain.setValueAtTime(0.0001, t0);
        g.gain.exponentialRampToValueAtTime(0.16, t0 + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.22);
        o.start(t0); o.stop(t0 + 0.25);
      }
    }

    muteBtn.addEventListener("click", () => {
      audioOn = !audioOn;
      muteBtn.textContent = audioOn ? "üîä Som" : "üîá Mudo";
      showToast(audioOn ? "Som ligado üîä" : "Mudo üîá");
      beep("pop");
    });

    // ==========================
    // PARALLAX subtil no card
    // ==========================
    let parallaxOn = true;
    function parallax(e){
      if(!parallaxOn) return;
      const r = card.getBoundingClientRect();
      const x = (e.clientX - (r.left + r.width/2)) / r.width;
      const y = (e.clientY - (r.top + r.height/2)) / r.height;
      const rx = (-y * 4).toFixed(2);
      const ry = (x * 6).toFixed(2);
      card.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
    }
    function parallaxReset(){
      card.style.transform = `rotateX(0deg) rotateY(0deg)`;
    }
    window.addEventListener("mousemove", parallax);
    window.addEventListener("mouseleave", parallaxReset);

    // ==========================
    // NO / YES behaviour
    // ==========================
    let noCount = 0;
    let yesScale = 1;
    let noScale = 1;

    const noPhrases = [
      "Tens a certeza? üòÖ",
      "Olha que eu fico triste‚Ä¶ ü•∫",
      "Isso foi o teu dedo a escorregar, certo? ü§è",
      "Ok‚Ä¶ mas repara no ursinho üêªüíî",
      "Quanto mais dizes n√£o‚Ä¶ mais o SIM aparece üòå",
      "Eu sabia que ias carregar no SIM eventualmente üòè",
      "O ‚ÄúN√£o‚Äù est√° a desaparecer‚Ä¶ üëÄ",
      "Pronto‚Ä¶ agora o SIM vai ocupar tudo üò≠üíò"
    ];

    function applyScales(){
      if(!yesBtn.classList.contains("yesFloating")){
        yesBtn.style.transform = `scale(${yesScale})`;
      }
      noBtn.style.transform  = `scale(${noScale})`;
      noBtn.style.opacity = Math.max(0.18, noScale).toFixed(2);
    }
    applyScales();

    // ===== portal takeover: move YES to body (FIX FINAL)
    let yesFloating = false;
    let targetCoverage = 1;
    let yesAnim = null;
    let yesPlaceholder = null;

    function floatYesOut(){
      if(yesFloating) return;

      yesFloating = true;
      sparkles.classList.add("on");
      showToast("O SIM est√° a ganhar‚Ä¶ üíò");
      beep("pop");

      // capture position
      const r = yesBtn.getBoundingClientRect();

      // placeholder to keep layout
      yesPlaceholder = document.createElement("span");
      yesPlaceholder.style.display = "inline-block";
      yesPlaceholder.style.width = r.width + "px";
      yesPlaceholder.style.height = r.height + "px";
      yesPlaceholder.style.verticalAlign = "middle";
      yesBtn.parentNode.insertBefore(yesPlaceholder, yesBtn);

      // MOVE to body (portal)
      document.body.appendChild(yesBtn);

      // fixed overlay
      yesBtn.classList.add("yesFloating","yesAura");
      yesBtn.style.left = r.left + "px";
      yesBtn.style.top  = r.top + "px";
      yesBtn.style.width = r.width + "px";
      yesBtn.style.height = r.height + "px";
      yesBtn.style.translate = "0 0";
      yesBtn.style.transform = "none";
      yesBtn.style.zIndex = "9999";

      animateYesToCoverage(1.10, 520);
    }

    function animateYesToCoverage(coverage, duration=900){
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const baseW = Math.min(vw * 0.92, 900);
      const baseH = 56;

      const big = coverage >= 4.2;

      let w = big ? vw * 0.98 : Math.min(vw * 0.95, baseW * coverage);
      let h = big ? Math.min(vh * 0.30, 150) : Math.min(vh * 0.22, baseH * Math.min(coverage, 4.0));

      const left = (vw - w) / 2;
      const top  = big ? (vh*0.60 - h/2) : Math.max(18, (vh * 0.70) - (h/2));

      const keyframes = [
        { left: yesBtn.style.left, top: yesBtn.style.top, width: yesBtn.style.width, height: yesBtn.style.height, filter: "brightness(1)" },
        { left: left + "px", top: top + "px", width: w + "px", height: h + "px", filter: "brightness(1.05)" }
      ];

      if(yesAnim) yesAnim.cancel();
      yesAnim = yesBtn.animate(keyframes, {
        duration,
        easing: "cubic-bezier(.2,.9,.15,1)",
        fill: "forwards"
      });
      yesAnim.onfinish = () => {
        yesBtn.style.left = keyframes[1].left;
        yesBtn.style.top = keyframes[1].top;
        yesBtn.style.width = keyframes[1].width;
        yesBtn.style.height = keyframes[1].height;
      };
    }

    function intensifyYesGrowth(){
      targetCoverage = Math.min(8.8, targetCoverage + (noCount < 4 ? 0.70 : 1.00));
      const dur = Math.min(1900, 740 + targetCoverage * 125);
      animateYesToCoverage(targetCoverage, dur);

      // extra: subtle pulse
      yesBtn.animate([{transform:"scale(1)"},{transform:"scale(1.03)"},{transform:"scale(1)"}],
        {duration: 900, easing:"ease-in-out"});
    }

    function bearReact(kind){
      // wink quickly
      bear.classList.add("wink");
      setTimeout(()=> bear.classList.remove("wink"), 220);
      if(kind==="sad"){
        showToast("Ursinho: ü•∫");
      }else if(kind==="happy"){
        showToast("Ursinho: ü•∞");
      }
    }

    // NO: shrink, move, maybe run away
    noBtn.addEventListener("click", () => {
      noCount++;
      triesPill.textContent = `tentativas do ‚ÄúN√£o‚Äù: ${noCount}`;

      noScale = Math.max(0.12, noScale * 0.74);
      yesScale = Math.min(2.6, yesScale * 1.08);
      applyScales();

      note.textContent = noPhrases[Math.min(noPhrases.length-1, noCount-1)];
      beep("pop");
      bearReact("sad");

      // shake
      noBtn.animate([
        { transform: `scale(${noScale}) translateX(0px)` },
        { transform: `scale(${noScale}) translateX(-6px)` },
        { transform: `scale(${noScale}) translateX(6px)` },
        { transform: `scale(${noScale}) translateX(0px)` },
      ], { duration: 220, iterations: 1 });

      // portal yes
      if(noCount === 1){
        floatYesOut();
      }else{
        intensifyYesGrowth();
      }

      // When tiny, "run away" from cursor (playful)
      if(noScale < 0.34){
        const dx = (Math.random()*2 - 1) * 26;
        const dy = (Math.random()*2 - 1) * 14;
        noBtn.style.translate = `${dx}px ${dy}px`;
      }
    });

    // NO runs away on hover when small
    noBtn.addEventListener("mouseenter", () => {
      if(noScale < 0.38 && !noBtn.disabled){
        const dx = (Math.random()*2 - 1) * 48;
        const dy = (Math.random()*2 - 1) * 24;
        noBtn.style.translate = `${dx}px ${dy}px`;
      }
    });

    // YES: show letter
    yesBtn.addEventListener("click", () => {
      // remove placeholder if any
      if(yesPlaceholder) yesPlaceholder.remove();

      yesBtn.disabled = true;
      noBtn.disabled = true;
      noBtn.style.opacity = 0.45;

      parallaxOn = false;
      card.style.transform = "rotateX(0deg) rotateY(0deg)";

      title.innerHTML = `AAAAA! <span style="color:var(--good)">ELA DISSE SIM</span> üíò`;
      note.textContent = "Ok‚Ä¶ isto ficou ridiculamente fofo. Miss√£o cumprida. üòå";

      const stampText = NAME ? `PARA ${NAME.toUpperCase()}` : "PARA TI";
      letterStamp.textContent = stampText;

      const lines = buildLetterLines();
      runTypewriter(lines);

      bearReact("happy");
      beep("yes");
      popConfetti();
      modal.classList.add("open");
      showToast("Carta entregue üíå");
    });

    // modal close
    closeBtn.addEventListener("click", () => modal.classList.remove("open"));
    modal.addEventListener("click", (e) => { if(e.target === modal) modal.classList.remove("open"); });

    // Copy
    copyBtn.addEventListener("click", async () => {
      const msg = buildCopyText();
      try{
        await navigator.clipboard.writeText(msg);
        copyNote.textContent = "Mensagem copiada! Agora √© s√≥ enviar üòâ";
        showToast("Copiado üíò");
        beep("pop");
      }catch{
        copyNote.textContent = "N√£o consegui copiar automaticamente ‚Äî mas podes selecionar e copiar manualmente.";
      }
    });

    // Save as PNG (no libs): draw paper area to canvas (simplified capture)
    saveBtn.addEventListener("click", () => {
      // We render a "pretty card" screenshot using canvas: background + paper text.
      // Not a perfect DOM screenshot, but fica muito bonito e r√°pido.
      const w = 1200, h = 720;
      const c = document.createElement("canvas");
      c.width = w; c.height = h;
      const x = c.getContext("2d");

      // background gradient
      const g = x.createLinearGradient(0,0,w,h);
      g.addColorStop(0, "#0b1020");
      g.addColorStop(1, "#1a0f1f");
      x.fillStyle = g; x.fillRect(0,0,w,h);

      // soft glow
      x.fillStyle = "rgba(255,77,125,0.18)";
      x.beginPath(); x.ellipse(w*0.25, h*0.22, 420, 220, 0, 0, Math.PI*2); x.fill();
      x.fillStyle = "rgba(52,211,153,0.12)";
      x.beginPath(); x.ellipse(w*0.78, h*0.18, 380, 220, 0, 0, Math.PI*2); x.fill();

      // paper card
      const px = 90, py = 80, pw = w-180, ph = h-160, rad = 28;
      roundRect(x, px, py, pw, ph, rad);
      x.fillStyle = "rgba(255,255,255,0.93)";
      x.fill();
      x.lineWidth = 3;
      x.strokeStyle = "rgba(0,0,0,0.06)";
      x.stroke();

      // header
      x.fillStyle = "rgba(20,20,20,0.92)";
      x.font = "700 44px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      x.fillText(NAME ? `Carta para ti, ${NAME} üíñ` : "Carta para ti üíñ", px+44, py+74);

      // stamp
      x.font = "900 20px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      const st = NAME ? `PARA ${NAME.toUpperCase()}` : "PARA TI";
      const stW = x.measureText(st).width;
      roundRect(x, px+pw-44-stW-34, py+36, stW+26, 36, 12);
      x.fillStyle = "rgba(255,77,125,0.14)";
      x.fill();
      x.strokeStyle = "rgba(255,77,125,0.45)";
      x.setLineDash([6,6]);
      x.stroke();
      x.setLineDash([]);
      x.fillStyle = "rgba(120,20,55,0.92)";
      x.fillText(st, px+pw-44-stW-21, py+62);

      // body text (use the already typed lines)
      x.fillStyle = "rgba(20,20,20,0.90)";
      x.font = "26px ui-serif, Georgia, 'Times New Roman', Times, serif";
      const typed = Array.from(letterText.querySelectorAll(".typeLine")).map(p => p.textContent);
      const textLines = (typed.length ? typed : buildLetterLines());
      let y = py + 130;
      for(const line of textLines){
        if(y > py+ph-120) break;
        x.fillText(line, px+44, y);
        y += (line === "" ? 18 : 38);
      }

      // signature
      const me = FROM ? `‚Äî ${FROM}` : "‚Äî Eu";
      x.font = "38px 'Brush Script MT','Segoe Script','Snell Roundhand',cursive";
      x.fillStyle = "rgba(20,20,20,0.85)";
      x.fillText(me, px+44, py+ph-56);

      // export
      const a = document.createElement("a");
      a.download = "carta_valentine.png";
      a.href = c.toDataURL("image/png");
      a.click();

      showToast("PNG guardado üñºÔ∏è");
      beep("pop");
    });

    function roundRect(ctx, x, y, w, h, r){
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
    }

    function buildCopyText(){
      const who = NAME ? `${NAME}` : "amor";
      const me = FROM ? `${FROM}` : "H√©lder";
      return `üíò ${who}, queres ser a minha Valentine? Prometo um dia bonito contigo. ‚Äî ${me}`;
    }

    function buildLetterLines(){
      const who = NAME ? `${NAME}` : "meu amor";
      const me = FROM ? `${FROM}` : "H√©lder";

      return [
        `Querida ${who},`,
        ``,
        `Hoje eu s√≥ queria dizer uma coisa simples‚Ä¶ mas que significa tudo:`,
        `eu escolho-te.`,
        ``,
        `Escolho o teu riso, a tua calma, e o teu caos bonito.`,
        `Escolho a forma como transformas um dia normal em qualquer coisa especial.`,
        ``,
        `Ent√£o fica oficial:`,
        `queres ser a minha Valentine? üíò`,
        ``,
        `Prometo tratar-te com carinho,`,
        `fazer-te rir quando precisares,`,
        `e criar mem√≥rias que valham a pena guardar.`,
        ``,
        `Com amor,`,
        `${me}`
      ];
    }

    // Typewriter
    let typingToken = 0;
    async function runTypewriter(lines){
      typingToken++;
      const token = typingToken;

      letterText.innerHTML = "";
      copyNote.textContent = "";

      for(const line of lines){
        if(token !== typingToken) return;
        const p = document.createElement("p");
        p.className = "typeLine";
        letterText.appendChild(p);
        await typeInto(p, line, 14);
        await sleep(line === "" ? 90 : 150);
      }
    }
    async function typeInto(el, text, speed){
      el.textContent = "";
      for(let i=0;i<text.length;i++){
        el.textContent += text[i];
        await sleep(speed + Math.random()*12);
      }
    }
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    // Resize: keep YES coverage consistent
    window.addEventListener("resize", () => {
      if(yesFloating && !yesBtn.disabled){
        animateYesToCoverage(targetCoverage, 420);
      }
    });

    // Reset
    resetBtn.addEventListener("click", () => location.reload());

    // ==========================
    // Confetti hearts
    // ==========================
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    let confetti, raf;

    function resizeCanvas(){
      canvas.width = window.innerWidth * devicePixelRatio;
      canvas.height = window.innerHeight * devicePixelRatio;
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(devicePixelRatio, devicePixelRatio);
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    function popConfetti(){
      confetti = [];
      const count = 200;
      for(let i=0;i<count;i++){
        confetti.push({
          x: Math.random()*window.innerWidth,
          y: -20 - Math.random()*window.innerHeight*0.2,
          vx: (Math.random()*2-1) * 3.2,
          vy: 2 + Math.random()*4.2,
          r: 3 + Math.random()*5,
          a: Math.random()*Math.PI*2,
          va: (Math.random()*2-1) * 0.12,
          life: 90 + Math.random()*70
        });
      }
      cancelAnimationFrame(raf);
      animateConfetti();
    }

    function drawHeart(x,y,s,rot){
      ctx.save();
      ctx.translate(x,y);
      ctx.rotate(rot);
      ctx.scale(s,s);
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.bezierCurveTo(-1.2,-1.2,-2.2,0.2,0,2.2);
      ctx.bezierCurveTo(2.2,0.2,1.2,-1.2,0,0);
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }

    function animateConfetti(){
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

      for(const p of confetti){
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.03;
        p.a += p.va;
        p.life -= 1;

        ctx.globalAlpha = Math.max(0, Math.min(1, p.life/140));
        ctx.fillStyle = (p.life % 2 === 0) ? "rgba(255,77,125,.95)" : "rgba(255,255,255,.92)";
        drawHeart(p.x, p.y, p.r/6, p.a);
      }

      ctx.globalAlpha = 1;
      confetti = confetti.filter(p => p.life > 0 && p.y < window.innerHeight + 40);

      if(confetti.length){
        raf = requestAnimationFrame(animateConfetti);
      }else{
        ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
      }
    }

  </script>
</body>
</html>
